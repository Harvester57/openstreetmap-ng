{# Render report comment based on action type #}
{# Parameters: report, comment, show_user (optional) #}

{# Show user who performed the action if requested #}
{% set _has_user = show_user and comment.user %}
{% if _has_user %}
<a href="/user/{{ comment.user.display_name }}">
    <img class="avatar" src="{{ user_avatar_url(comment.user) }}" alt="{{ t('alt.profile_picture') }}">
    {{- comment.user.display_name -}}
</a><span class="text-muted">:</span>
{% endif %}

{# Build category phrase if present #}
{% if comment.category %}
{% set _category %}
<span class="report-category" data-category="{{ comment.category }}">{{ comment.category }}</span>
{% endset %}
{% endif %}

{# Show action-specific content #}
{% set _has_body = comment.has_access and comment.body %}
<span
    class="report-action {% if _has_body and (_has_user or comment.action != 'comment') %}report-action-with-body{% endif %}">
    {% if not comment.has_access %}
    <i class="bi bi-lock text-muted me-1-5"></i>{#--#}
    <em class="text-muted">Restricted comment</em>

    {% elif comment.action == 'comment' %}

    {% elif comment.action == 'close' %}
    <i class="bi bi-check-circle text-success me-1-5"></i>{#--#}
    Closed report

    {% elif comment.action == 'reopen' %}
    <i class="bi bi-arrow-counterclockwise text-warning me-1-5"></i>{#--#}
    Reopened report

    {% elif comment.action == 'generic' %}
    <i class="bi bi-flag text-danger me-1-5"></i>{#--#}
    Reported for {{ _category | safe }}

    {% elif comment.action == 'user_account' %}
    <i class="bi bi-life-preserver text-info me-1-5"></i>{#--#}
    Reported a problem with {{ _category | safe }}

    {% elif comment.action == 'user_changeset' %}
    <i class="bi bi-geo-alt text-danger me-1-5"></i>{#--#}
    Reported
    <a href="/changeset/{{ comment.action_id }}" target="_blank">changeset {{ comment.action_id }}</a>
    for {{ _category | safe }}

    {% elif comment.action == 'user_diary' %}
    <i class="bi bi-journal-x text-danger me-1-5"></i>{#--#}
    Reported
    <a href="/diary/{{ comment.action_id }}" target="_blank">
        diary entry
        {% if comment.object is defined -%}
        “{{ comment.object.title }}”
        {%- else -%}
        «Deleted»
        {%- endif -%}
    </a>
    for {{ _category | safe }}

    {% elif comment.action == 'user_message' %}
    <i class="bi bi-envelope-x text-danger me-1-5"></i>{#--#}
    Reported
    <a href="/messages/inbox?show={{ comment.action_id }}" target="_blank">
        message
        {% if comment.object is defined -%}
        “{{ comment.object.subject }}”
        {%- else -%}
        «Deleted»
        {%- endif -%}
    </a>
    for {{ _category | safe }}

    {% elif comment.action == 'user_note' %}
    <i class="bi bi-pin-angle text-danger me-1-5"></i>{#--#}
    Reported
    <a href="/note/{{ comment.action_id }}" target="_blank">note {{ comment.action_id }}</a>
    for {{ _category | safe }}

    {% elif comment.action == 'user_oauth2_application' %}
    <i class="bi bi-app-indicator text-danger me-1-5"></i>{#--#}
    Reported application
    {% if comment.object is defined %}
    “{{ comment.object.name }}” ({{ comment.action_id }})
    {%- for uri in comment.object.redirect_uris -%}
    <sup class="text-nowrap">[<a href="{{ uri }}" target="_blank" rel="noopener noreferrer">{{ loop.index }}</a>]</sup>
    {%- endfor -%}
    {% else %}
    «Deleted» ({{ comment.action_id }})
    {% endif %}
    for {{ _category | safe }}

    {% elif comment.action == 'user_profile' %}
    <i class="bi bi-person-badge text-danger me-1-5"></i>{#--#}
    Reported
    <a href="/user-id/{{ report.type_id }}" target="_blank">user profile</a>
    for {{ _category | safe }}

    {% elif comment.action == 'user_trace' %}
    <i class="bi bi-geo text-danger me-1-5"></i>{#--#}
    Reported
    <a href="/trace/{{ comment.action_id }}" target="_blank">
        GPS trace
        {% if comment.object is defined -%}
        “{{ comment.object.name }}”
        {%- else -%}
        «Deleted»
        {%- endif -%}
    </a>
    for {{ _category | safe }}

    {% endif %}
</span>

<div class="report-body">
    {%- if _has_body %}{{ comment.body_rich | safe }}{% else %}<p></p>{% endif -%}
</div>
